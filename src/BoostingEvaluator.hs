import Control.DeepSeq
import Data.Monoid
import Data.Map

import HLearn.Base
import HLearn.DataContainers
import HLearn.DataContainers.DS_List
import HLearn.Evaluation.CrossValidation
import HLearn.Evaluation.Metrics
import HLearn.Math.Functors
import HLearn.Math.TypeClasses
import HLearn.Models.AlgTree
import HLearn.Models.Distributions
import HLearn.Models.DTree
import HLearn.Models.KNN
import HLearn.Models.NBayes
import HLearn.Models.Ensemble
import HLearn.Models.Ensemble.ASSEMBLE
import HLearn.Models.Ensemble.AdaBoost
import HLearn.Models.Ensemble.Bagging
import HLearn.Models.Ensemble.SemiBoost

datafile = DatafileDesc 
        { datafilePath = "/home/user/proj/haskell-classification/testdata/bupa.data" 
--         { datafileName = "/home/user/proj/haskell-classification/testdata/haberman.csv" 
--         { datafileName = "/home/user/proj/haskell-classification/testdata/german.csv" 
--         { datafileName = "/home/user/proj/haskell-classification/testdata/kr-vs-kp.data" 
--         { datafileName = "/home/user/proj/haskell-classification/testdata/tic-tac-toe.data" 
        , datafileLabelColumn = First
        , datafileMissingStr = Nothing
        }
            
main = do
    putStrLn "loading data"
    ds <- loadDataCSV datafile :: IO (DS_List String (LDPS String))
    deepseq ds $ putStrLn "done."
    let dsint = runHLearn 10 $ randomize $ ds2intds ds
    let dsbool = ds2boolds [0] dsint

    let ds=dsint

    -----------------------------------
    -- run tests
    
--     let baseparams = CategoricalParams
--     let baseparams = defDStumpParams { maxDepth=1, leafModelParams = defNBayesParams }
--     let baseparams = defDStumpParams { maxDepth=1 }
    let baseparams = defAlgTreeParams
--     let baseparams = defNBayesParams
--     let baseparams = defKNNParams 
--         
-- --     let x = runHLearn 10 $ crossValidation (ensemblify accuracy) (AdaBoostParams 20 baseparams) dsint 0.8 10
--     let x = runHLearn 10 $ crossValidation (ensemblify accuracy) 
-- --                                           (Trainer2TrainerSS defAdaBoostParams) 
--                                           (defSemigroupSS 4 $ defASSEMBLEParams { weightedParams = Trainer2WeightedTrainer 0.5 baseparams } )
-- --                                           ( SemiBoostParams 20 $ Trainer2WeightedTrainer 0.1 baseparams ) 
--                                           ds (0.8) 0.1 10
--     deepseq x $ return x
--     
--     putStrLn "-------- boost ------"
--     print x
--     
--     putStrLn "-------- base ------"
--     let y= runHLearn 10 $ crossValidation accuracy (Trainer2TrainerSS baseparams) ds 0.08 0.1 10
--     print y

--     let stumpy = runHLearn 30 $ trainBatch (TrainerSS2Trainer $ defASSEMBLEParams { rounds=30 }) dsint
--     let stumpy = runHLearn 11 $ trainBatch (AdaBoostParams 50 baseparams) dsint
    let stumpy = runHLearn 10 $ trainBatch baseparams dsint
--     let stumpy=DTree {HLearn.Classifiers.DTree.dataDesc = DataDesc {numLabels = 2, labelL = [0,1], numAttr = 3}, root = (2,[(DLeaf (Categorical {desc = DataDesc {numLabels = 2, labelL = [0,1], numAttr = 3}, dist = fromList [(0,17),(1,25)]}),LT,Continuous 0.0),(DLeaf (Categorical {desc = DataDesc {numLabels = 2, labelL = [0,1], numAttr = 3}, dist = fromList [(0,31),(1,27)]}),GT,Continuous 0.0)])}
    deepseq stumpy $ return () -- print stumpy
--     putStrLn $ "accuracy = " ++ show (accuracy stumpy dsint)
    
    putStrLn $ "CM = " ++ show (genConfusionMatrix stumpy dsint)


{-

---------------------------------------
-- BUPA --- with DStump

(full ada)
[0.636112537566574,0.6299392720607601,0.6247285467695072,0.6349492478716259,0.6309194497061408,0.6153722939152705,0.6145964202551719,0.6092410698739298,0.6179192426586262,0.6063024016686714,0.6153307656973779,0.6207352957782845,0.5847669908916812,0.6028869271683468,0.6363223846846866,0.5849868529003361,0.6233960239290384,0.5537673446356172,0.5923031633977291,0.5771786153361553,0.5348594840168676,0.5583975542799923,0.6019477443090554,0.6019477443090554,0.6019477443090554,0.6160467967726881]
[4.8839977818939256e-2,5.350644196701249e-2,5.288730467467605e-2,4.317751579821588e-2,6.011691732751915e-2,6.987862464423986e-2,3.299798688776018e-2,6.507268901082522e-2,6.663653618111537e-2,7.595601041016772e-2,7.78470882931627e-2,5.702656462715314e-2,8.827771131367781e-2,9.020112190830257e-2,4.9863102533105434e-2,7.91740247011647e-2,6.474160198541545e-2,9.358993546036959e-2,6.555353115608016e-2,0.11025318247456453,9.931260199605754e-2,9.417602826711051e-2,4.46297982272443e-2,4.46297982272443e-2,4.46297982272443e-2,3.992752671077161e-2]

(1/5 ada)
[0.6036114455408917,0.6030740620969273,0.5940259577223904,0.6066019639034862,0.6044732441350432,0.5931022815799984,0.5945820747225257,0.5996255028583315,0.5915505325950532,0.6087384814831067,0.5951535510712764,0.5841723626414423,0.590918731497063,0.6040720135661786,0.5992166692563283,0.5948743184452022,0.6018403000455262,0.5998794690470284,0.5867246995074085,0.5786153235881302,0.5667472208280696,0.5711833622616969,0.5400960921026206,0.5589114231130734,0.5589114231130734,0.585043019208192]
[3.146271029028041e-2,3.756241502250597e-2,3.7884975893075816e-2,3.186762542077257e-2,3.775968912946162e-2,3.592490169300137e-2,5.858175918193227e-2,4.1925841496215685e-2,4.726781444869334e-2,4.201180259199444e-2,5.461654726567808e-2,4.988313153146908e-2,5.161661165091587e-2,4.973049556690261e-2,3.426435623910369e-2,5.06188232057876e-2,4.906241880591854e-2,4.093175602543248e-2,3.216089969116684e-2,6.457180620115588e-2,4.409616442976859e-2,3.94769453311927e-2,5.812554938916842e-2,4.264547499452422e-2,4.264547499452422e-2,1.2742832805422755e-2]

(sg 5mod/10)
[0.6426671754891947,0.638171561454107,0.6401715873109378,0.6416208626732567,0.6387223119486191,0.6401715873109378,0.6366628153811134,0.633579011237987,0.633579011237987,0.633579011237987,0.6350495994732811,0.633532450807795,0.6365472363536492,0.6305249225603287,0.6288996792657254,0.6270077480380116,0.626814935141003,0.6253807060869417,0.6168049352412713,0.6252516697836299,0.6111797883032104,0.5985066051037522,0.6019185136105848,0.5537076768909525,0.5537076768909525,0.5884085369956407]
--[4.108738843081577e-2,4.452284832061721e-2,4.520684411016442e-2,4.43090394093699e-2,4.65406759398358e-2,4.520684411016442e-2,4.726280462274684e-2,4.479387572896112e-2,4.479387572896112e-2,4.479387572896112e-2,4.656485963340003e-2,4.80826055782763e-2,4.9254781900409425e-2,4.880491384002776e-2,4.555447807624093e-2,5.0209784139878415e-2,5.8396138670417624e-2,5.112197482638528e-2,5.273097474412093e-2,3.773116867140797e-2,7.19811717200178e-2,5.7957229992877564e-2,5.701568192168422e-2,7.60775014412602e-2,7.60775014412602e-2,6.993251459966668e-2]



---------------------------------------
-- KR-VS-KP --- with NBayes

(1/4 Ada)
[0.8848844255485513,0.8773482037708885,0.8897097392984343,0.8832852701190572,0.8863135899149369,0.8811461957580027,0.8805888113546155,0.8820303274495389,0.8819232038755441,0.8838347007750806,0.8877015230760175,0.8758719275318337,0.8871492064953445,0.8870888255738633,0.8834548662835572,0.8858149317687656,0.8758419146178891,0.8955341978711117,0.8826028342211888,0.8902173110322796,0.8862630485813615,0.8734008048056296,0.8943827822117962,0.823088689951901,0.8176778683086144,0.4777736622239644]
--[2.140330714952771e-2,1.8399121471683367e-2,1.619825255244156e-2,2.7742714548997252e-2,1.101402395040516e-2,2.2734569800357225e-2,1.9103357949222105e-2,2.4152858732502638e-2,1.8009855362001323e-2,1.6238153631369684e-2,1.6107720975461846e-2,1.8067775140395613e-2,1.844947482310217e-2,1.7414198646457248e-2,2.2087185106372805e-2,2.513414630482459e-2,2.4741283075320336e-2,1.7359878521680902e-2,2.2463074061252974e-2,2.3575837983182402e-2,1.8228618842331e-2,2.9938203373298965e-2,2.2500176133975616e-2,3.6831855411410055e-2,2.8610237969034776e-2,6.017685726875556e-3]

(full ada)
[0.8989066739198711,0.8993178312254122,0.8985595501120418,0.8964771997384031,0.9029099639467378,0.90398667989345,0.9044076170799505,0.9003132827354776,0.9032680815636523,0.906267115741204,0.8941896036912582,0.9086717202164099,0.8918406121487925,0.9088233114551094,0.8942243303549983,0.9083498350454484,0.888620418000512,0.9084627813838215,0.881859173176262,0.9093120515012915,0.888699582454694,0.9210258043034283,0.8966728598819894,0.9187212666859687,0.8662656952175058,0.48734938106968856]
-- [1.9546688658003526e-2,2.1354796674944464e-2,2.3231577973016178e-2,1.8625170543192984e-2,2.6880950282987807e-2,2.312484388856524e-2,2.052737381523683e-2,1.8849160769502583e-2,2.959368515747882e-2,1.6847213310157736e-2,2.9010273359290583e-2,2.1488873115415048e-2,2.755884828206762e-2,2.3705301416637327e-2,2.4556150780178948e-2,2.32138834590112e-2,2.662820535837378e-2,2.3044956797542607e-2,2.862203145252588e-2,2.0216097463272107e-2,3.210941974308034e-2,1.9413451591616022e-2,3.140218639379221e-2,2.4076687832439807e-2,2.5777065322781657e-2,1.741422783580701e-2]

(sg 4/10)
[0.9151873365842496,0.9151873365842496,0.9151873365842496,0.9151873365842496,0.9151873365842496,0.9151873365842496,0.9151873365842496,0.9151873365842496,0.9151873365842496,0.9151873365842496,0.9151873365842496,0.9151873365842496,0.9151873365842496,0.9151873365842496,0.9153354847323977,0.9153354847323977,0.9153354847323977,0.915173672434663,0.9151804459727079,0.9147404378783147,0.9142435510989347,0.9118851481241036,0.9058289338074055,0.9022862606995149,0.9022862606995149,0.48475278061788746]
--[1.4513843146859851e-2,1.4513843146859851e-2,1.4513843146859851e-2,1.4513843146859851e-2,1.4513843146859851e-2,1.4513843146859851e-2,1.4513843146859851e-2,1.4513843146859851e-2,1.4513843146859851e-2,1.4513843146859851e-2,1.4513843146859851e-2,1.4513843146859851e-2,1.4513843146859851e-2,1.4513843146859851e-2,1.4288601001427061e-2,1.4288601001427061e-2,1.4288601001427061e-2,1.4331849282373426e-2,1.4116373169130614e-2,1.5047398805345145e-2,1.5193069893992144e-2,1.0297730737583694e-2,1.712481586691538e-2,2.122989670560214e-2,2.122989670560214e-2,1.719937411944149e-2]

(sg 5mod/10)
[0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9180126811573575,0.9178581216519479,0.9178581216519479,0.9178634274260142,0.9164687785897979,0.9162793938774939,0.906072269775855,0.906072269775855,0.906072269775855,0.47454390105771727]
-- [1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.6732999762767285e-2,1.65800865442542e-2,1.65800865442542e-2,1.68585365347597e-2,1.7629381985392607e-2,1.7654658303422284e-2,1.9374068472093896e-2,1.9374068472093896e-2,1.9374068472093896e-2,1.4651367783328591e-2]

(sg 8/10)
[0.9136605481007725,0.9136605481007725,0.9136605481007725,0.9136605481007725,0.9136605481007725,0.9136605481007725,0.9136605481007725,0.9136605481007725,0.9136605481007725,0.9136605481007725,0.9136605481007725,0.9136605481007725,0.9136915078530944,0.9136915078530944,0.9137242410773169,0.9137838985686817,0.9137855741748717,0.9136927876609618,0.913236532276079,0.9129926602745386,0.9127941539196559,0.9111085272518799,0.905226582155844,0.9035900141701386,0.9035900141701386,0.48005175205084843]
-- [1.084007599443887e-2,1.084007599443887e-2,1.084007599443887e-2,1.084007599443887e-2,1.084007599443887e-2,1.084007599443887e-2,1.084007599443887e-2,1.084007599443887e-2,1.084007599443887e-2,1.084007599443887e-2,1.084007599443887e-2,1.084007599443887e-2,1.0854796847821266e-2,1.0854796847821266e-2,1.090616748557022e-2,1.095809187158226e-2,1.0918727271145817e-2,1.1118452532416613e-2,1.082644583713385e-2,1.1287278394549665e-2,1.158972161489416e-2,1.1472938883232128e-2,1.5079312863227952e-2,1.578712014094214e-2,1.578712014094214e-2,1.7605608880747147e-2]

(sg 16/50)
[0.9129864346470665,0.9129864346470665,0.9129864346470665,0.9129864346470665,0.9129864346470665,0.9129864346470665,0.9129864346470665,0.9129864346470665,0.9129864346470665,0.9129864346470665,0.9129864346470665,0.9130202184308501,0.9130202184308501,0.9129836106156048,0.9130812593389678,0.9129491971009156,0.9128840347598891,0.9129165797653229,0.9133451768541216,0.9125811760179768,0.913054004016868,0.9129036639094781,0.9083254257201753,0.9064483121597159,0.9064483121597159,0.4750195289369192]
-- [1.2607515440089775e-2,1.2607515440089775e-2,1.2607515440089775e-2,1.2607515440089775e-2,1.2607515440089775e-2,1.2607515440089775e-2,1.2607515440089775e-2,1.2607515440089775e-2,1.2607515440089775e-2,1.2607515440089775e-2,1.2607515440089775e-2,1.2612142789861072e-2,1.2612142789861072e-2,1.252851195276572e-2,1.258728334822217e-2,1.254716875542332e-2,1.2533054297419719e-2,1.2510620757851948e-2,1.3368424376975835e-2,1.2710316182963756e-2,1.2949480702781667e-2,1.318194667386801e-2,1.8538746659963815e-2,1.9179635110549167e-2,1.9179635110549167e-2,1.7243386939018918e-2]

(1/16 ada)
[0.8210837377083328,0.8332224515779018,0.8300457499630013,0.8271530626101629,0.8338443203761458,0.8256545747088336,0.8231109599421886,0.822548769424306,0.8254919831618996,0.8281732177654182,0.838165184218232,0.8320765738676145,0.8277711162980301,0.8280661290540882,0.810448613384936,0.8294333600995057,0.809112023181759,0.8197034365395182,0.8103230948953398,0.8276927168908313,0.820491777419064,0.8226094675473934,0.8114980394985915,0.7884861050479454,0.7816806871424282,0.4782244486653421]
-- [3.369663984624158e-2,2.2807243063967562e-2,2.8868237180909872e-2,3.826997745574242e-2,2.257835283585125e-2,1.5399544471748895e-2,3.277979821120962e-2,1.3637997896826501e-2,2.9445063307696615e-2,2.102562848769722e-2,1.2604644662439912e-2,1.9616517346757945e-2,2.6817716586031985e-2,2.450640958842783e-2,1.7673889178129284e-2,2.6555704399710594e-2,3.592001094368411e-2,2.8941628747966075e-2,3.022675954312727e-2,3.241509551009667e-2,3.320336177589329e-2,3.395089817737378e-2,3.1616378490755555e-2,2.720465483352226e-2,3.0285172718558045e-2,1.8934292234731244e-3]

(sg 32/10)
[0.905750599586227,0.905750599586227,0.905750599586227,0.905750599586227,0.905750599586227,0.905750599586227,0.905750599586227,0.905750599586227,0.905750599586227,0.905750599586227,0.905750599586227,0.905750599586227,0.905750599586227,0.905750599586227,0.905750599586227,0.9055890486976972,0.9055890486976972,0.9057508609954317,0.9059049442003624,0.9046620772737475,0.9063943549385867,0.9033017447840394,0.9040836490316306,0.8965390175066464,0.8965390175066464,0.4882191997133151]
-- [1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.472315077808998e-2,1.5114038623043703e-2,1.5114038623043703e-2,1.501353392538014e-2,1.5094451207648647e-2,1.5738778081814887e-2,1.474313366747095e-2,1.6919361268193944e-2,1.578294287096413e-2,2.330981602633857e-2,2.330981602633857e-2,2.3649075980559552e-2]

(sg 32mod/10)
[0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8897965109215407,0.8899508319091951,0.8896272073137258,0.8894553514130229,0.8894651572332674,0.888648827897783,0.8877460278265243,0.8833982863291141,0.8772067943822318,0.8772067943822318,0.4882191997133151]
-- [1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5658270343894172e-2,1.5857458242790407e-2,1.570591389919106e-2,1.6004720779402876e-2,1.5554504398808249e-2,1.680235375175414e-2,1.6904238438162193e-2,1.3636760725389172e-2,1.8390800547924774e-2,1.8390800547924774e-2,2.3649075980559552e-2]

(1/32 ada)
[0.7679940200850142,0.7634111874577596,0.7631065005930514,0.7668146978599528,0.756308733982118,0.7710367155801666,0.7646698187835457,0.7506406236664317,0.7517770497518076,0.7639426557751298,0.7752849650462652,0.7479709771497765,0.7685097644211375,0.7586451664074283,0.7478775003778914,0.7565556799135029,0.7400547153412129,0.7603078527243317,0.7595678450718686,0.7779640265778163,0.7606540389629604,0.7640477666981721,0.7701173440259783,0.73273605679998,0.73273605679998,0.47808149850026854]
-- [3.884414462581084e-2,4.7739467401331406e-2,3.749338275424619e-2,5.341945385234601e-2,3.446432638938366e-2,4.564092170172511e-2,6.110884173548585e-2,5.484246422747472e-2,5.100325168846848e-2,5.443496772958275e-2,4.826034756830475e-2,6.583082893634835e-2,3.778279503657215e-2,3.3452430352353305e-2,3.1976585915951816e-2,3.7799314856308566e-2,4.0090432348923455e-2,2.5359429623945953e-2,4.596890197177996e-2,4.379723966531286e-2,5.068575113697314e-2,4.9019308710230636e-2,4.938351835218044e-2,3.914957237937742e-2,3.914957237937742e-2,1.4227277271290028e-3]
-}